node 
{

	// Get Artifactory server instance, defined in the Artifactory Plugin administration page.
    	def server = Artifactory.server "01"
    	def buildInfo = Artifactory.newBuildInfo() 

	// Project Dir
    	def project_path = "Download"

	stage('GitCheckOut') {
		git branch: 'stage', credentialsId: '01', url: 'https://github.com/amitvashisttech/devops301-mindtree-09-Jan-2021.git'
	}

	dir(project_path){
		stage('Build Managment') {
      			def downloadSpec = """{
	 					"files": [
								{
								"pattern": "petclinic/*.war",
								"target": "files/"
        							}
							]
					}"""
			server.download spec: downloadSpec
 		}

      	 	stage('Deployment - Stage'){
			 deploy adapters: [tomcat8(credentialsId: '01', path: '', url: 'http://knrga38148dns.eastus2.cloudapp.azure.com:8080/')], contextPath: 'PetclinicTomcat', onFailure: false, war: '01-Jenkins/petclinic-code/target/*.war'

		}
	}
}
